print((lambda r: (len((lambda f, a, b, c: f(f, a, b, c))(lambda f, a, b, c: c[a] if a in c else (lambda d: d if c.__setitem__(a, d) is None else None)(set([p for parent in [k for k, v in b.items() if a in v] for p in [parent, *f(f, parent, b, c)]])), 'shiny gold', {rule_parts[0]: (lambda f, rule_strings, rule_dictionary: f(f, rule_strings, rule_dictionary))(lambda f, rule_strings, rule_dictionary: f(f, rule_strings[1:], (lambda groups: {groups['colour']: int(groups['amount']), **rule_dictionary})(r.match('(?P<amount>\\d*) (?P<colour>.*)', rule_strings[0]).groupdict())) if len(rule_strings) > 0 and rule_strings[0] != 'no other' else rule_dictionary, rule_parts[1:], {}) for rule_parts in [i.split(', ') for i in r.sub(' contain ', ', ', r.sub('( bags*|\n)', '', open('_').read())).split('.') if i != '']}, {}))))(__import__('re')))